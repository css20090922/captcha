# HTSRC 高鐵訂票驗證碼

### 免責條款

此專案是個人學習如何使用 Deep Learning 中的 CNN，使用 Python 的 Keras、Tensorflow 進行實作，請勿使用於不法用途。若因使用該專案而大量訂票，相關的刑事、民事相關責任，請自行負責。

### 參考資料

其實基本上都是依照下面三個參考資料在實作，所以有疑問請在參考一下這些資料。

[gary9987/-Keras-Python3.6-captcha](https://github.com/gary9987/-Keras-TensorFlow-Python3.6-)

[[爬蟲實戰] 如何破解高鐵驗證碼 (1) - 去除圖片噪音點?](https://www.youtube.com/watch?v=6HGbKdB4kVY)

[[爬蟲實戰] 如何破解高鐵驗證碼 (2) - 使用迴歸方法去除多餘弧線?](https://www.youtube.com/watch?v=4DHcOPSfC4c)

###主要需要的套件
tensorflow-gpu 2.1.0
keras 2.3.1
cudnn 7.6.5
cupy  6.0.0
hdf5 1.10.4
numpy 1.18.1
opencv 3.3.1

###資料來源是上網找其他專案來的，來源分別是

[gary9987/-Keras-Python3.6-captcha](https://github.com/gary9987/-Keras-TensorFlow-Python3.6-)
[HTSRC 高鐵訂票驗證碼](https://github.com/maxmilian/thsrc_captcha)

### 步驟
大致上分為四個步驟，以下會分步驟說明

- 爬蟲
- 預處理
- 標記圖片
- CNN深度學習
一三步驟已經先有人先做好了
預處理的部分在 dataset/loaddata.py裡面
之後只有負責調整模型以及資料的擴充處裡

###CNN部分

__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to
==================================================================================================
input_1 (InputLayer)            (None, 60, 160, 3)   0
__________________________________________________________________________________________________
conv2d_1 (Conv2D)               (None, 60, 160, 32)  896         input_1[0][0]
__________________________________________________________________________________________________
conv2d_2 (Conv2D)               (None, 58, 158, 32)  9248        conv2d_1[0][0]
__________________________________________________________________________________________________
max_pooling2d_1 (MaxPooling2D)  (None, 29, 79, 32)   0           conv2d_2[0][0]
__________________________________________________________________________________________________
conv2d_3 (Conv2D)               (None, 29, 79, 64)   18496       max_pooling2d_1[0][0]
__________________________________________________________________________________________________
conv2d_4 (Conv2D)               (None, 27, 77, 64)   36928       conv2d_3[0][0]
__________________________________________________________________________________________________
max_pooling2d_2 (MaxPooling2D)  (None, 13, 38, 64)   0           conv2d_4[0][0]
__________________________________________________________________________________________________
conv2d_5 (Conv2D)               (None, 13, 38, 128)  73856       max_pooling2d_2[0][0]
__________________________________________________________________________________________________
conv2d_6 (Conv2D)               (None, 11, 36, 128)  147584      conv2d_5[0][0]
__________________________________________________________________________________________________
batch_normalization_1 (BatchNor (None, 11, 36, 128)  44          conv2d_6[0][0]
__________________________________________________________________________________________________
max_pooling2d_3 (MaxPooling2D)  (None, 5, 18, 128)   0           batch_normalization_1[0][0]
__________________________________________________________________________________________________
conv2d_7 (Conv2D)               (None, 5, 18, 256)   295168      max_pooling2d_3[0][0]
__________________________________________________________________________________________________
conv2d_8 (Conv2D)               (None, 5, 18, 256)   590080      conv2d_7[0][0]
__________________________________________________________________________________________________
max_pooling2d_4 (MaxPooling2D)  (None, 2, 9, 256)    0           conv2d_8[0][0]
__________________________________________________________________________________________________
conv2d_9 (Conv2D)               (None, 2, 9, 512)    1180160     max_pooling2d_4[0][0]
__________________________________________________________________________________________________
batch_normalization_2 (BatchNor (None, 2, 9, 512)    2048        conv2d_9[0][0]
__________________________________________________________________________________________________
max_pooling2d_5 (MaxPooling2D)  (None, 1, 4, 512)    0           batch_normalization_2[0][0]
__________________________________________________________________________________________________
flatten_1 (Flatten)             (None, 2048)         0           max_pooling2d_5[0][0]
__________________________________________________________________________________________________
dropout_1 (Dropout)             (None, 2048)         0           flatten_1[0][0]
__________________________________________________________________________________________________
digit1 (Dense)                  (None, 19)           38931       dropout_1[0][0]
__________________________________________________________________________________________________
digit2 (Dense)                  (None, 19)           38931       dropout_1[0][0]
__________________________________________________________________________________________________
digit3 (Dense)                  (None, 19)           38931       dropout_1[0][0]
__________________________________________________________________________________________________
digit4 (Dense)                  (None, 19)           38931       dropout_1[0][0]
==================================================================================================
Total params: 2,510,232
Trainable params: 2,509,186
Non-trainable params: 1,046
__________________________________________________________________________________________________


由於一開始用20000筆DATA下去訓練的時候發現不夠，所以後來用原本的資料擴充到180000筆data

[train history](trainres/generator_accuracy23.png)
[train loss](trainres/generator_loss23.png)

dataset/loaddata.py負責載入資料跟預處裡
keras_model.py負責訓練
test_model.py負責測試準確度